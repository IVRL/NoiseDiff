# NoiseDiff

**Dark Noise Diffusion: Noise Synthesis for Low-Light Image Denoising**  
ðŸ“„ [View on arXiv](https://arxiv.org/abs/2503.11262v1)

---

**Authors**  
[Liying Lu](https://skyelu.github.io/) &nbsp;|&nbsp; 
[RaphaÃ«l Achddou](https://rachddou.github.io/) &nbsp;|&nbsp; 
[Sabine SÃ¼sstrunk](https://people.epfl.ch/sabine.susstrunk)



## Get Started

1. **Clone the repository**
    ```bash
    git clone https://github.com/SkyeLu/NoiseDiff.git
    cd NoiseDiff
    ```

2. **Install dependencies**  
   Run the installation script to set up the required environment.  
   Please install PyTorch and torchvision versions matching your device.
    ```bash
    bash install.sh
    ```

3. **Download the SID and ELD datasets**  
   Download the SID dataset from the [Learning-to-See-in-the-Dark repository](https://github.com/cchen156/Learning-to-See-in-the-Dark) and the ELD dataset from the [ELD repository](https://github.com/Vandermode/ELD).  
   Please follow the instructions in each repository for downloading and preparing the datasets. Also change the data path in the `dataloader/dataset.py`, `dataloader/dataset_denoising.py` and `test_denoising.py` accordingly.

4. **Download the dark shading resources for denoising training**  
   Download the dark shading resources from the [PMN repository](https://github.com/megvii-research/PMN/tree/main/resources), place the `resources` folder under the root directory.

5. **Download the pre-trained models**  
   Download the pre-trained models from [Google Drive](https://drive.google.com/drive/folders/1kIXX-ya_6PQ5UMAzx8YVf2XApq6_53YV?usp=sharing), and place the `pretrained_ckpts` folder under the root directory. 

6. **(Optional) Download our synthetic data**  
   The noise images generated by our model can be downloaded from [HuggingFace](https://huggingface.co/datasets/SkyeLu/NoiseDiffData).

---

## Usage

All commands for training and testing are provided in `script.sh`. You can modify the parameters in the script as needed.

### 1. Diffusion Network Training & Testing (Data Generation)

- **Training:**  
  Run the training command in `script.sh` to train the diffusion network. You can train it using our provided synthetic data or your own generated data.
- **Testing / Data Generation:**  
  Use the provided command to generate synthetic noise data. Set the `--resume` argument to the path of your trained model checkpoint, or use the provided pretrained checkpoints in the `--pretrained_ckpts` folder.

- **Logs:** Training logs will be saved in the `./logs` folder.
- **Output:** Generated data will be saved in the `./output` folder.  
  *(Save paths can be changed by changing the `--save_folder` in the commands.)*

### 2. Denoising Network Training & Testing

- **Training:**  
  Use the corresponding command in `script.sh` to train the denoising network.
- **Testing:**  
  Run the test command to evaluate the denoising performance on the SID or ELD dataset, with or without dark shading correction. Set the `--resume` argument to the path of your trained model checkpoint, or use the provided pretrained checkpoints in the `--pretrained_ckpts` folder.

- **Logs:** Training logs will be saved in the `./logs` folder.
- **Output:** Denoising results will be saved in the `./output` folder.  
  *(Save paths can be changed by changing the `--save_folder` in the commands.)*

---

## Notes

- *The synthetic dataset is a bit large, we are still trying to upload the complete dataset.*
- For any issues or questions, please open an issue on this repository, or contact us via email at liying.lu@epfl.ch.

---

## Acknowledgement

This project refers to some code from the following repositories, we thank the authors for their contributions and publishing their code:
- [Denoising-Diffusion-Pytorch](https://github.com/lucidrains/denoising-diffusion-pytorch)
- [Learning-to-See-in-the-Dark](https://github.com/cchen156/Learning-to-See-in-the-Dark)
- [PMN](https://github.com/megvii-research/PMN)

---

## Citation

If you find this work useful, please cite our paper:

```
@inproceedings{NoiseDiff2025,
  title     = {Dark Noise Diffusion: Noise Synthesis for Low-Light Image Denoising},
  author    = {Lu, Liying and Achddou, Rapha{\"e}l and S{\"u}sstrunk, Sabine},
  booktitle = {Proceedings of the International Conference on Computational Photography (ICCP)},
  year      = {2025}
}
```
